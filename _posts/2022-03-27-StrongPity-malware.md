---
layout:     post
title:      恶意软件分析（九）：APT组织StrongPity样本分析
subtitle:   伪装成WinRAR的样本分析
date:       2022-03-27
author:     Hongtai S
header-img: img/24.jpg
catalog: true
tags:
    - 逆向
    - 二进制
    - 恶意代码分析
    - APT
---
# 样本来源

在推特发现一篇疑似StrongPity APT组织的样本：

![1.png](https://s2.loli.net/2022/03/27/OMrHzfa1cKnQI4Y.png)

链接：[https://twitter.com/RedDrip7/status/1504640743738003456](https://twitter.com/RedDrip7/status/1504640743738003456)

# 样本信息

样本文件名：WinRAR.exe

样本文件格式：exe文件，C++编写

![2.png](https://s2.loli.net/2022/03/27/juQABL7lh9PTeZW.png)

样本MD5：ae72b18b38e4421a37a93c0820ddd83b

样本SHA1：c867f045cedec1c559f9d0f4a4f7b1a9e92b5565

样本SHA256：d8e09efe37e802b6541b97b22ca49d467fb02d2f7b7319fda0eed4fdc2e21e2b


# 样本分析

样本首先加载、解密资源节：

![3.png](https://s2.loli.net/2022/03/27/9CcV5vgsUo2xl43.png)

随后将解密后的资源节写入3个文件：

![4.png](https://s2.loli.net/2022/03/27/xAzhPi2k9Yd5HsT.png)

写入的文件分别是winrar-x64-602.exe、simserv.exe和svvsrv.exe：

![5.png](https://s2.loli.net/2022/03/27/bF1PTevSjwdgtK6.png)

![6.png](https://s2.loli.net/2022/03/27/rUBQ1wziA4sJ7Wq.png)

![7.png](https://s2.loli.net/2022/03/27/NEHWkl6AJswByTP.png)

将其中svvsrv.exe设置为开机自启：

![8.png](https://s2.loli.net/2022/03/27/DrxOUjAgomfwCM9.png)
![9.png](https://s2.loli.net/2022/03/27/Bob1YayQDWXw7hL.png)

其中winrar-x64-602.exe用于掩饰自身，是正常的WinRAR安装程序。

![10.png](https://s2.loli.net/2022/03/27/7EUsZwjzODct19o.png)

simserv.exe程序主要用于收集系统文件，程序首先遍历文件系统：

![11.png](https://s2.loli.net/2022/03/27/bpGfvjoarznIsw2.png)

若遍历的路径是文件，那么判断后缀名：

![12.png](https://s2.loli.net/2022/03/27/hCj2KiSosYf6Ugz.png)

![13.png](https://s2.loli.net/2022/03/27/BsufJKLHjCF3oYm.png)

出现匹配后缀的文件将读取文件数据并且将加密的数据存放于新的文件中，文件命名格式为：guid_app0_硬盘序列号_月日时分秒毫秒_0.sft。

![14.png](https://s2.loli.net/2022/03/27/xigB67JZV9RNykO.png)

每个与后缀匹配的文件都生成一个sft加密文件：

![15.png](https://s2.loli.net/2022/03/27/NW7GX3y8gT2ka1O.png)

另外，目录下还生成了一个cnfz文件，文件开头是PK签名，能够被压缩软件识别：

![16.png](https://s2.loli.net/2022/03/27/QIxj2WcbehEyCot.png)

解压包中的文件是被窃取信息的文本

![17.png](https://s2.loli.net/2022/03/27/x4ANBYQFfgVdhoD.png)

svvsrv.exe文件用于将加密的数据发送至指定的远程服务器。首先检索simserv.exe生成的sft文件：

![18.png](https://s2.loli.net/2022/03/27/3Fhrp6VMaIgjdU5.png)

读取检索到的文件

![19.png](https://s2.loli.net/2022/03/27/8K3kUIRV5E21dLv.png)
![20.png](https://s2.loli.net/2022/03/27/XPF3tyLCaDdQNp8.png)

然后向服务器https://sessionprotocol[.]com/parse_ini_file.php发送数据：

![21.png](https://s2.loli.net/2022/03/27/uEfbzgaseKy1ZrI.png)

# 关联分析

StrongPity组织最早于2016年10月被公开的时候，传播的方法就是使用水坑攻击颁发包含恶意软件的WinRAR，该样本的攻击手法与之前相似

![22.png](https://s2.loli.net/2022/03/27/v4i8TPBWeNR9K1C.png)

此外，在之前的该组织样本分析中提到了“文件搜索器”，通过搜索磁盘文件中的特定扩展名，将其整合为zip文件，然后将zip分割为多个sft加密文件，发送至C&C服务器，与该样本行为基本吻合：

![23.png](https://s2.loli.net/2022/03/27/KNXJW5RQPpHiEdG.png)

链接：[https://thehackernews.com/2020/06/strongpity-syria-turkey-hackers.html](https://thehackernews.com/2020/06/strongpity-syria-turkey-hackers.html)

# IOCs

MD5:

20019653c96f9556133a9bc4d811e6ae

31c05fe3c509d9594b6f8bc2bb5f2fd1

C&C:

sessionprotocol[.]com/parse_ini_file.php

sessionprotocol[.]com

IP:

172.105.27.36
