---
layout:     post
title:      恶意软件分析（四）：python恶意代码分析
subtitle:   pyc格式木马分析
date:       2021-12-23
author:     Hongtai S
header-img: img/19.jpg
catalog: true
tags:
    - 逆向
    - 二进制
    - 恶意代码分析
---
# 样本基本信息

样本文件名称：829fd66f58b8c67088569aae4fdf46cc.dll.vir

样本MD5：829fd66f58b8c67088569aae4fdf46cc

样本SHA-1：7bc0d6ff342c09ca320aa487196fc7991322cd93

样本SHA-256：94ed0f2751d9de280ef6eabe29f41dd74bacc36ecef4c58f44798128d0497297

样本文件格式：样本为pyinstaller打包生成的exe

![1.png](https://s2.loli.net/2022/02/27/9t72e8mPxyuTSVM.png)

# 样本行为分析

## 修改注册表键值

![2.png](https://s2.loli.net/2022/02/27/CmHMSauOcJ5hGwU.png)

## http请求

![3.png](https://s2.loli.net/2022/02/27/bmciJyShML57Kn8.png)

情报中心查询该ip，标签为木马回连和Shelma：

![4.png](https://s2.loli.net/2022/02/27/UeoMxhmK8nbINXG.png)

# 样本静态分析

使用pyinstxtractor.py脚本解包得到python文件：

![5.png](https://s2.loli.net/2022/02/27/4WrhgaUKoqDPBZ3.png)

找到文件名称可疑的shell.pyc，使用uncompyle6还原代码得到以下python代码：

![6.png](https://s2.loli.net/2022/02/27/oChHeIB2tGA6DXc.png)

AbCCDe字符串经过base64解码后得到如下python代码：

![7.png](https://s2.loli.net/2022/02/27/fiqEAesCcmYhkKW.png)

AbCCDeBsaaSSfKK2经过两次base64解码得到64位的shellcode，然后将shellcode注入到进程中。shellcode中存在回连的恶意ip：

![8.png](https://s2.loli.net/2022/02/27/PF4M3qXoNWt6Jch.png)